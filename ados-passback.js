// Generated by CoffeeScript 1.12.6
(function() {
  var getPassbackContext, sendPostMessages;

  getPassbackContext = function(window, isMultipleFlights, divName) {
    var fnName, passback, ref, ref1, ref2, thisPassback, tryParent, windowWithPassback;
    fnName = isMultipleFlights ? 'azk_passback' : 'ados_passback';
    tryParent = (function(_this) {
      return function(window, divName) {
        if (window === window.parent) {
          return {
            adosFound: false
          };
        }
        return getPassbackContext(window.parent, isMultipleFlights, divName);
      };
    })(this);
    try {
      divName = (ref = window.divName) != null ? ref : divName;
      if (window[fnName] != null) {
        windowWithPassback = window;
        passback = window[fnName];
      } else if (window.parent[fnName] != null) {
        windowWithPassback = window.parent;
        passback = window.parent[fnName];
      }
      thisPassback = windowWithPassback != null ? (ref1 = windowWithPassback.ados) != null ? (ref2 = ref1.passbacks) != null ? ref2[divName] : void 0 : void 0 : void 0;
      if (!((divName != null) && (passback != null) && (thisPassback != null))) {
        return tryParent(window, divName);
      }
      return {
        adosFound: true,
        passback: passback,
        divName: divName
      };
    } catch (error) {
      return {
        unfriendlyIframe: true
      };
    }
  };

  sendPostMessages = function(window, flightId, isMultipleFlights) {
    var msg;
    msg = isMultipleFlights ? {
      flightIds: flightId
    } : {
      flightId: flightId
    };
    window.postMessage(msg, '*');
    if (window !== window.parent) {
      return sendPostMessages(window.parent, flightId, isMultipleFlights);
    }
  };

  window.passbackToAdzerk = function(flightId) {
    var adosFound, divName, flightIdStr, isMultipleFlights, passback, ref, unfriendlyIframe;
    isMultipleFlights = flightId instanceof Array;
    ref = getPassbackContext(window, isMultipleFlights), adosFound = ref.adosFound, unfriendlyIframe = ref.unfriendlyIframe, passback = ref.passback, divName = ref.divName;
    flightIdStr = isMultipleFlights ? "flights " + (flightId.join(', ')) : "flight " + flightId;
    if (adosFound) {
      console.log("Passing back to Adzerk " + flightIdStr + "...");
      return passback(divName, flightId);
    } else if (unfriendlyIframe) {
      console.log("Sending Adzerk postMessage for " + flightIdStr + "...");
      return sendPostMessages(window, flightId, isMultipleFlights);
    } else {
      return console.error("Unable to find an appropriate window for Adzerk passback.");
    }
  };

}).call(this);
